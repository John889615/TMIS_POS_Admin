{"ast":null,"code":"var _jsxFileName = \"C:\\\\Sandbox\\\\ReactPosTemplate\\\\src\\\\feature-module\\\\stock\\\\purchaseOrderLineTree.jsx\",\n  _s3 = $RefreshSig$();\nimport React, { useState, useEffect } from \"react\";\nimport { getAllProducts } from \"../../services/product/product\";\nimport { getAllPurchaseOrder, newPurchaseOrder, updatePurchaseOrder } from \"../../services/stock/purchaseOrderService\";\nimport { getAllPurchaseOrderLine, newPurchaseOrderLine } from \"../../services/stock/purchaseOrderLineService\";\nimport { useParams } from \"react-router-dom\";\nimport { useSelector } from \"react-redux\";\nimport { DndContext, useDraggable, useDroppable, DragOverlay } from \"@dnd-kit/core\";\nimport { Modal, Button, Form } from \"react-bootstrap\";\nimport { PlusCircle } from \"react-feather\";\nimport { getAllCostCenter } from \"../../services/debtors/costCenter\";\nimport PurchaseOrderForm from \"../../core/modals/stocks/purchaseOrderFormModel\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst PurchaseOrderLineTree = () => {\n  _s3();\n  var _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n  const {\n    id\n  } = useParams();\n  const [purchaseOrdersWithProducts, setPurchaseOrdersWithProducts] = useState([]);\n  const [productList, setProductList] = useState([]);\n  const [openOrders, setOpenOrders] = useState({});\n  const [activeProduct, setActiveProduct] = useState(null); // store picked product\n  const debtorId = useSelector(state => state.selectedDebtorStore);\n  const [showModal, setShowModal] = useState(false);\n  const [selectedProductId, setSelectedProductId] = useState(null);\n  const [selectedOrder, setSelectedOrder] = useState(null);\n  const [quantity, setQuantity] = useState(1);\n  const [notes, setNotes] = useState(\"\");\n  const [modelShow, setModelShow] = useState(false);\n  const [selectedData, setSelectedData] = useState(null);\n  const [costCenterList, setCostCenterList] = useState([]);\n  useEffect(() => {\n    fetchPurchaseOrder();\n    fetchRecords();\n  }, [debtorId]);\n  const fetchPurchaseOrder = async () => {\n    try {\n      const type = await getAllProducts();\n      setProductList(type);\n      const orders = await getAllPurchaseOrder(debtorId !== null && debtorId !== void 0 ? debtorId : 1);\n      const ordersWithLines = await Promise.all(orders.map(async order => {\n        const lines = await getAllPurchaseOrderLine(order.POS_PurchaseOrderID);\n        return {\n          ...order,\n          Products: lines\n        };\n      }));\n      setPurchaseOrdersWithProducts(ordersWithLines);\n\n      // all open by default\n      const collapseState = {};\n      ordersWithLines.forEach(o => {\n        collapseState[o.POS_PurchaseOrderID] = true;\n      });\n      setOpenOrders(collapseState);\n    } catch (err) {\n      console.error(\"Failed to load purchase orders:\", err.message);\n    }\n  };\n  const fetchRecords = async () => {\n    try {\n      const type = await getAllCostCenter();\n      setCostCenterList(type);\n    } catch (err) {\n      console.error(\"Failed to load addresses:\", err.message);\n    }\n  };\n  const toggleOrder = orderId => {\n    setOpenOrders(prev => ({\n      ...prev,\n      [orderId]: !prev[orderId]\n    }));\n  };\n\n  // --- Draggable Product ---\n  function DraggableProduct({\n    product\n  }) {\n    _s();\n    const {\n      attributes,\n      listeners,\n      setNodeRef,\n      isDragging\n    } = useDraggable({\n      id: `product-${product.POS_ProductID}`,\n      data: product\n    });\n    return /*#__PURE__*/_jsxDEV(\"li\", {\n      ref: setNodeRef,\n      ...attributes,\n      ...listeners,\n      className: `list-group-item d-flex justify-content-between align-items-center ${isDragging ? \"opacity-50\" : \"\"}`,\n      style: {\n        cursor: \"grab\"\n      },\n      children: product.ProductName || \"Unnamed\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 13\n    }, this);\n  }\n\n  // --- Droppable Order ---\n  _s(DraggableProduct, \"qVa/SUqh328E+ViKUYzN8k5jOTU=\", false, function () {\n    return [useDraggable];\n  });\n  function DroppableOrder({\n    order,\n    children\n  }) {\n    _s2();\n    const {\n      setNodeRef,\n      isOver\n    } = useDroppable({\n      id: `order-${order.POS_PurchaseOrderID}`\n    });\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: setNodeRef,\n      className: `p-2 border rounded ${isOver ? \" bg-info bg-opacity-50 border-primary shadow\" : \"\"}`,\n      style: {\n        transition: \"background 0.2s, border 0.2s\",\n        minHeight: \"100px\"\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 13\n    }, this);\n  }\n  _s2(DroppableOrder, \"DmJTTt6A5xWIX/faBiFge3FOLrw=\", false, function () {\n    return [useDroppable];\n  });\n  const handleDragStart = event => {\n    if (event.active.id.startsWith(\"product-\")) {\n      setActiveProduct(event.active.data.current);\n    }\n  };\n  const handleDragEnd = async event => {\n    const {\n      active,\n      over\n    } = event;\n    setActiveProduct(null); // clear overlay\n\n    if (active && over && active.id.startsWith(\"product-\") && over.id.startsWith(\"order-\")) {\n      const productId = active.data.current.POS_ProductID;\n      const orderId = parseInt(over.id.replace(\"order-\", \"\"));\n      const product = productList.find(p => p.POS_ProductID === productId);\n      try {\n        setSelectedProductId(productId);\n        setSelectedOrder(orderId);\n        setQuantity(1);\n        setNotes(\"\");\n        setShowModal(true);\n        // TODO: call newPurchaseOrderLine API here if needed\n      } catch (err) {\n        console.error(\"Failed to add product to order:\", err.message);\n      }\n    }\n  };\n  const handleSave = async () => {\n    try {\n      var data = {\n        POS_PurchaseOrderLineID: null,\n        FK_ProductID: selectedProductId,\n        FK_PurchaseOrderID: selectedOrder,\n        Quantity: quantity,\n        Notes: notes\n      };\n      const payload = {\n        PurchaseOrderLines: [data] // ✅ Wrap in array and key\n      };\n      var response = await newPurchaseOrderLine(payload);\n      setPurchaseOrdersWithProducts([]);\n      fetchPurchaseOrder();\n      setShowModal(false);\n    } catch (err) {\n      console.error(\"Failed to save order line:\", err.message);\n    }\n  };\n  const handleClose = () => setModelShow(false);\n  const handleAddProduct = async data => {\n    console.log(\"Data : \", data);\n    try {\n      if (data.POS_PurchaseOrderID) {\n        await updatePurchaseOrder(data);\n      } else {\n        await newPurchaseOrder(data);\n      }\n      await fetchPurchaseOrder();\n      setModelShow(false);\n    } catch (err) {\n      console.error(\"Error creating user:\", err.message);\n    }\n  };\n  const handleShow = () => {\n    setSelectedData(null);\n    setModelShow(true);\n  };\n  const handleEditOrder = record => {\n    setSelectedData(record);\n    setModelShow(true);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"page-wrapper\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"content\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"page-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"add-item d-flex\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"page-title\",\n            children: /*#__PURE__*/_jsxDEV(\"h4\", {\n              children: \"Purchase Orders\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 206,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 205,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"page-btn\",\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"none\",\n            className: \"btn btn-added\",\n            onClick: handleShow,\n            children: [/*#__PURE__*/_jsxDEV(PlusCircle, {\n              className: \"me-2\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 211,\n              columnNumber: 29\n            }, this), \"Add New Order\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 210,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 209,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(DndContext, {\n        onDragStart: handleDragStart,\n        onDragEnd: handleDragEnd,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"row\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-lg-8\",\n            children: purchaseOrdersWithProducts.map(order => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"card mb-3\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"card-header d-flex justify-content-between align-items-center\",\n                style: {\n                  cursor: \"pointer\"\n                },\n                onClick: () => toggleOrder(order.POS_PurchaseOrderID),\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"d-flex align-items-center\",\n                  children: [/*#__PURE__*/_jsxDEV(\"h6\", {\n                    className: \"mb-0 me-2\",\n                    children: order.OrderNumber\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 233,\n                    columnNumber: 45\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    type: \"button\",\n                    className: \"btn btn-sm btn-outline-primary\",\n                    onClick: e => {\n                      e.stopPropagation(); // prevent toggle when clicking edit\n                      handleEditOrder(order); // your edit function\n                    },\n                    children: /*#__PURE__*/_jsxDEV(\"i\", {\n                      className: \"feather-edit\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 243,\n                      columnNumber: 49\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 235,\n                    columnNumber: 45\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 232,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: openOrders[order.POS_PurchaseOrderID] ? \"−\" : \"+\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 246,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 227,\n                columnNumber: 37\n              }, this), openOrders[order.POS_PurchaseOrderID] && /*#__PURE__*/_jsxDEV(DroppableOrder, {\n                order: order,\n                children: /*#__PURE__*/_jsxDEV(\"ul\", {\n                  className: \"list-group list-group-flush\",\n                  children: order.Products.length > 0 ? order.Products.map(p => /*#__PURE__*/_jsxDEV(\"li\", {\n                    className: \"list-group-item d-flex justify-content-between\",\n                    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                      children: [p.ProductName, \" - Qty: \", p.Quantity]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 261,\n                      columnNumber: 61\n                    }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                      className: \"text-muted\",\n                      children: p.UnitCostExcl\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 264,\n                      columnNumber: 61\n                    }, this)]\n                  }, p.ProductID, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 257,\n                    columnNumber: 57\n                  }, this)) : /*#__PURE__*/_jsxDEV(\"li\", {\n                    className: \"list-group-item text-muted\",\n                    children: \"No products yet\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 270,\n                    columnNumber: 53\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 254,\n                  columnNumber: 45\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 253,\n                columnNumber: 41\n              }, this)]\n            }, order.POS_PurchaseOrderID, true, {\n              fileName: _jsxFileName,\n              lineNumber: 225,\n              columnNumber: 33\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 223,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-lg-4\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"card\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"card-header\",\n                children: /*#__PURE__*/_jsxDEV(\"h5\", {\n                  className: \"mb-0\",\n                  children: \"Products (Drag to Order)\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 285,\n                  columnNumber: 37\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 284,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"card-body\",\n                style: {\n                  maxHeight: \"600px\",\n                  overflowY: \"auto\"\n                },\n                children: productList.length > 0 ? /*#__PURE__*/_jsxDEV(\"ul\", {\n                  className: \"list-group\",\n                  children: productList.map(product => /*#__PURE__*/_jsxDEV(DraggableProduct, {\n                    product: product\n                  }, product.POS_ProductID, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 294,\n                    columnNumber: 49\n                  }, this))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 292,\n                  columnNumber: 41\n                }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"text-muted text-center\",\n                  children: \"No products available\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 301,\n                  columnNumber: 41\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 287,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 283,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 282,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(DragOverlay, {\n          children: activeProduct ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"list-group-item d-flex justify-content-between align-items-center bg-light shadow rounded\",\n            children: [activeProduct.ProductName, /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"badge bg-primary rounded-pill\",\n              children: activeProduct.Price || \"N/A\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 315,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 313,\n            columnNumber: 29\n          }, this) : null\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Modal, {\n        show: showModal,\n        onHide: () => setShowModal(false),\n        centered: true,\n        children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n          closeButton: true,\n          children: /*#__PURE__*/_jsxDEV(Modal.Title, {\n            children: \"Add Product to Order\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 325,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 324,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n          children: /*#__PURE__*/_jsxDEV(Form, {\n            children: [/*#__PURE__*/_jsxDEV(Form.Group, {\n              className: \"mb-3\",\n              children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n                children: \"Quantity\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 330,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n                type: \"number\",\n                min: \"1\",\n                value: quantity,\n                onChange: e => setQuantity(Number(e.target.value))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 331,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 329,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Form.Group, {\n              className: \"mb-3\",\n              children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n                children: \"Notes\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 340,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n                as: \"textarea\",\n                rows: 3,\n                value: notes,\n                onChange: e => setNotes(e.target.value)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 341,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 339,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 328,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 327,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            variant: \"secondary\",\n            onClick: () => setShowModal(false),\n            children: \"Cancel\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 351,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"primary\",\n            onClick: handleSave,\n            children: \"Save\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 354,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 350,\n          columnNumber: 21\n        }, this)]\n      }, 1, true, {\n        fileName: _jsxFileName,\n        lineNumber: 323,\n        columnNumber: 17\n      }, this), modelShow && /*#__PURE__*/_jsxDEV(PurchaseOrderForm, {\n        onSubmit: handleAddProduct,\n        showModel: modelShow,\n        handleClose: handleClose,\n        data: selectedData,\n        costCenterList: costCenterList\n      }, 2, false, {\n        fileName: _jsxFileName,\n        lineNumber: 361,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 201,\n    columnNumber: 9\n  }, this);\n};\n_s3(PurchaseOrderLineTree, \"UNrRBX2pKsN4j0DGOijd/MLLZCU=\", false, function () {\n  return [useParams, useSelector];\n});\n_c = PurchaseOrderLineTree;\nexport default PurchaseOrderLineTree;\nvar _c;\n$RefreshReg$(_c, \"PurchaseOrderLineTree\");","map":{"version":3,"names":["React","useState","useEffect","getAllProducts","getAllPurchaseOrder","newPurchaseOrder","updatePurchaseOrder","getAllPurchaseOrderLine","newPurchaseOrderLine","useParams","useSelector","DndContext","useDraggable","useDroppable","DragOverlay","Modal","Button","Form","PlusCircle","getAllCostCenter","PurchaseOrderForm","jsxDEV","_jsxDEV","PurchaseOrderLineTree","_s3","_s","$RefreshSig$","_s2","id","purchaseOrdersWithProducts","setPurchaseOrdersWithProducts","productList","setProductList","openOrders","setOpenOrders","activeProduct","setActiveProduct","debtorId","state","selectedDebtorStore","showModal","setShowModal","selectedProductId","setSelectedProductId","selectedOrder","setSelectedOrder","quantity","setQuantity","notes","setNotes","modelShow","setModelShow","selectedData","setSelectedData","costCenterList","setCostCenterList","fetchPurchaseOrder","fetchRecords","type","orders","ordersWithLines","Promise","all","map","order","lines","POS_PurchaseOrderID","Products","collapseState","forEach","o","err","console","error","message","toggleOrder","orderId","prev","DraggableProduct","product","attributes","listeners","setNodeRef","isDragging","POS_ProductID","data","ref","className","style","cursor","children","ProductName","fileName","_jsxFileName","lineNumber","columnNumber","DroppableOrder","isOver","transition","minHeight","handleDragStart","event","active","startsWith","current","handleDragEnd","over","productId","parseInt","replace","find","p","handleSave","POS_PurchaseOrderLineID","FK_ProductID","FK_PurchaseOrderID","Quantity","Notes","payload","PurchaseOrderLines","response","handleClose","handleAddProduct","log","handleShow","handleEditOrder","record","variant","onClick","onDragStart","onDragEnd","OrderNumber","e","stopPropagation","length","UnitCostExcl","ProductID","maxHeight","overflowY","Price","show","onHide","centered","Header","closeButton","Title","Body","Group","Label","Control","min","value","onChange","Number","target","as","rows","Footer","onSubmit","showModel","_c","$RefreshReg$"],"sources":["C:/Sandbox/ReactPosTemplate/src/feature-module/stock/purchaseOrderLineTree.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { getAllProducts } from \"../../services/product/product\";\r\nimport { getAllPurchaseOrder, newPurchaseOrder, updatePurchaseOrder } from \"../../services/stock/purchaseOrderService\";\r\nimport { getAllPurchaseOrderLine, newPurchaseOrderLine } from \"../../services/stock/purchaseOrderLineService\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { DndContext, useDraggable, useDroppable, DragOverlay } from \"@dnd-kit/core\";\r\nimport { Modal, Button, Form } from \"react-bootstrap\"\r\nimport {\r\n    PlusCircle,\r\n} from \"react-feather\";\r\nimport { getAllCostCenter } from \"../../services/debtors/costCenter\";\r\nimport PurchaseOrderForm from \"../../core/modals/stocks/purchaseOrderFormModel\";\r\n\r\n\r\nconst PurchaseOrderLineTree = () => {\r\n    const { id } = useParams();\r\n    const [purchaseOrdersWithProducts, setPurchaseOrdersWithProducts] = useState([]);\r\n    const [productList, setProductList] = useState([]);\r\n    const [openOrders, setOpenOrders] = useState({});\r\n    const [activeProduct, setActiveProduct] = useState(null); // store picked product\r\n    const debtorId = useSelector((state) => state.selectedDebtorStore);\r\n    const [showModal, setShowModal] = useState(false);\r\n    const [selectedProductId, setSelectedProductId] = useState(null);\r\n    const [selectedOrder, setSelectedOrder] = useState(null);\r\n    const [quantity, setQuantity] = useState(1);\r\n    const [notes, setNotes] = useState(\"\");\r\n    const [modelShow, setModelShow] = useState(false);\r\n    const [selectedData, setSelectedData] = useState(null);\r\n    const [costCenterList, setCostCenterList] = useState([]);\r\n    useEffect(() => {\r\n        fetchPurchaseOrder();\r\n        fetchRecords();\r\n    }, [debtorId]);\r\n\r\n    const fetchPurchaseOrder = async () => {\r\n        try {\r\n            const type = await getAllProducts();\r\n            setProductList(type);\r\n\r\n            const orders = await getAllPurchaseOrder(debtorId ?? 1);\r\n            const ordersWithLines = await Promise.all(\r\n                orders.map(async (order) => {\r\n                    const lines = await getAllPurchaseOrderLine(order.POS_PurchaseOrderID);\r\n                    return { ...order, Products: lines };\r\n                })\r\n            );\r\n            setPurchaseOrdersWithProducts(ordersWithLines);\r\n\r\n            // all open by default\r\n            const collapseState = {};\r\n            ordersWithLines.forEach((o) => {\r\n                collapseState[o.POS_PurchaseOrderID] = true;\r\n            });\r\n            setOpenOrders(collapseState);\r\n        } catch (err) {\r\n            console.error(\"Failed to load purchase orders:\", err.message);\r\n        }\r\n    };\r\n\r\n    const fetchRecords = async () => {\r\n        try {\r\n            const type = await getAllCostCenter();\r\n            setCostCenterList(type);\r\n        } catch (err) {\r\n            console.error(\"Failed to load addresses:\", err.message);\r\n        }\r\n    };\r\n\r\n    const toggleOrder = (orderId) => {\r\n        setOpenOrders((prev) => ({\r\n            ...prev,\r\n            [orderId]: !prev[orderId],\r\n        }));\r\n    };\r\n\r\n    // --- Draggable Product ---\r\n    function DraggableProduct({ product }) {\r\n        const { attributes, listeners, setNodeRef, isDragging } = useDraggable({\r\n            id: `product-${product.POS_ProductID}`,\r\n            data: product,\r\n        });\r\n\r\n        return (\r\n            <li\r\n                ref={setNodeRef}\r\n                {...attributes}\r\n                {...listeners}\r\n                className={`list-group-item d-flex justify-content-between align-items-center ${isDragging ? \"opacity-50\" : \"\"\r\n                    }`}\r\n                style={{ cursor: \"grab\" }}\r\n            >\r\n                {product.ProductName || \"Unnamed\"}\r\n            </li>\r\n        );\r\n    }\r\n\r\n    // --- Droppable Order ---\r\n    function DroppableOrder({ order, children }) {\r\n        const { setNodeRef, isOver } = useDroppable({\r\n            id: `order-${order.POS_PurchaseOrderID}`,\r\n        });\r\n\r\n        return (\r\n            <div\r\n                ref={setNodeRef}\r\n                className={`p-2 border rounded ${isOver ? \" bg-info bg-opacity-50 border-primary shadow\" : \"\"\r\n                    }`}\r\n                style={{\r\n                    transition: \"background 0.2s, border 0.2s\",\r\n                    minHeight: \"100px\"\r\n                }}\r\n            >\r\n                {children}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const handleDragStart = (event) => {\r\n        if (event.active.id.startsWith(\"product-\")) {\r\n            setActiveProduct(event.active.data.current);\r\n        }\r\n    };\r\n\r\n    const handleDragEnd = async (event) => {\r\n        const { active, over } = event;\r\n        setActiveProduct(null); // clear overlay\r\n\r\n        if (\r\n            active &&\r\n            over &&\r\n            active.id.startsWith(\"product-\") &&\r\n            over.id.startsWith(\"order-\")\r\n        ) {\r\n            const productId = active.data.current.POS_ProductID;\r\n            const orderId = parseInt(over.id.replace(\"order-\", \"\"));\r\n            const product = productList.find((p) => p.POS_ProductID === productId);\r\n            try {\r\n                setSelectedProductId(productId);\r\n                setSelectedOrder(orderId);\r\n                setQuantity(1);\r\n                setNotes(\"\");\r\n                setShowModal(true);\r\n                // TODO: call newPurchaseOrderLine API here if needed\r\n            } catch (err) {\r\n                console.error(\"Failed to add product to order:\", err.message);\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        try {\r\n            var data = {\r\n                POS_PurchaseOrderLineID: null,\r\n                FK_ProductID: selectedProductId,\r\n                FK_PurchaseOrderID: selectedOrder,\r\n                Quantity: quantity,\r\n                Notes: notes,\r\n            };\r\n            const payload = {\r\n                PurchaseOrderLines: [data], // ✅ Wrap in array and key\r\n            };\r\n            var response = await newPurchaseOrderLine(payload);\r\n            setPurchaseOrdersWithProducts([]);\r\n            fetchPurchaseOrder();\r\n            setShowModal(false);\r\n        } catch (err) {\r\n            console.error(\"Failed to save order line:\", err.message);\r\n        }\r\n    };\r\n\r\n    const handleClose = () => setModelShow(false);\r\n    const handleAddProduct = async (data) => {\r\n        console.log(\"Data : \", data);\r\n        try {\r\n            if (data.POS_PurchaseOrderID) {\r\n                await updatePurchaseOrder(data);\r\n            }\r\n            else {\r\n                await newPurchaseOrder(data);\r\n            }\r\n            await fetchPurchaseOrder();\r\n            setModelShow(false);\r\n        } catch (err) {\r\n            console.error(\"Error creating user:\", err.message);\r\n        }\r\n    };\r\n\r\n    const handleShow = () => {\r\n        setSelectedData(null);\r\n        setModelShow(true)\r\n    };\r\n\r\n    const handleEditOrder = (record) => {\r\n        setSelectedData(record);\r\n        setModelShow(true);\r\n    };\r\n\r\n\r\n    return (\r\n        <div className=\"page-wrapper\">\r\n            <div className=\"content\">\r\n                <div className=\"page-header\">\r\n                    <div className=\"add-item d-flex\">\r\n                        <div className=\"page-title\">\r\n                            <h4>Purchase Orders</h4>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"page-btn\">\r\n                        <Button variant=\"none\" className=\"btn btn-added\" onClick={handleShow}>\r\n                            <PlusCircle className=\"me-2\" />\r\n                            Add New Order\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n\r\n                <DndContext\r\n                    onDragStart={handleDragStart}\r\n                    onDragEnd={handleDragEnd}\r\n                >\r\n                    <div className=\"row\">\r\n                        {/* Left: Collapsible Orders */}\r\n                        <div className=\"col-lg-8\">\r\n                            {purchaseOrdersWithProducts.map((order) => (\r\n                                <div className=\"card mb-3\" key={order.POS_PurchaseOrderID}>\r\n                                    {/* Header (click to toggle) */}\r\n                                    <div\r\n                                        className=\"card-header d-flex justify-content-between align-items-center\"\r\n                                        style={{ cursor: \"pointer\" }}\r\n                                        onClick={() => toggleOrder(order.POS_PurchaseOrderID)}\r\n                                    >\r\n                                        <div className=\"d-flex align-items-center\">\r\n                                            <h6 className=\"mb-0 me-2\">{order.OrderNumber}</h6>\r\n                                            {/* Edit button next to order name */}\r\n                                            <button\r\n                                                type=\"button\"\r\n                                                className=\"btn btn-sm btn-outline-primary\"\r\n                                                onClick={(e) => {\r\n                                                    e.stopPropagation(); // prevent toggle when clicking edit\r\n                                                    handleEditOrder(order); // your edit function\r\n                                                }}\r\n                                            >\r\n                                                <i className=\"feather-edit\"></i>\r\n                                            </button>\r\n                                        </div>\r\n                                        <span>\r\n                                            {openOrders[order.POS_PurchaseOrderID] ? \"−\" : \"+\"}\r\n                                        </span>\r\n                                    </div>\r\n\r\n                                    {/* Collapsible body */}\r\n                                    {openOrders[order.POS_PurchaseOrderID] && (\r\n                                        <DroppableOrder order={order}>\r\n                                            <ul className=\"list-group list-group-flush\">\r\n                                                {order.Products.length > 0 ? (\r\n                                                    order.Products.map((p) => (\r\n                                                        <li\r\n                                                            key={p.ProductID}\r\n                                                            className=\"list-group-item d-flex justify-content-between\"\r\n                                                        >\r\n                                                            <span>\r\n                                                                {p.ProductName} - Qty: {p.Quantity}\r\n                                                            </span>\r\n                                                            <span className=\"text-muted\">\r\n                                                                {p.UnitCostExcl}\r\n                                                            </span>\r\n                                                        </li>\r\n                                                    ))\r\n                                                ) : (\r\n                                                    <li className=\"list-group-item text-muted\">\r\n                                                        No products yet\r\n                                                    </li>\r\n                                                )}\r\n                                            </ul>\r\n                                        </DroppableOrder>\r\n                                    )}\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n\r\n                        {/* Right: Products */}\r\n                        <div className=\"col-lg-4\">\r\n                            <div className=\"card\">\r\n                                <div className=\"card-header\">\r\n                                    <h5 className=\"mb-0\">Products (Drag to Order)</h5>\r\n                                </div>\r\n                                <div\r\n                                    className=\"card-body\"\r\n                                    style={{ maxHeight: \"600px\", overflowY: \"auto\" }}\r\n                                >\r\n                                    {productList.length > 0 ? (\r\n                                        <ul className=\"list-group\">\r\n                                            {productList.map((product) => (\r\n                                                <DraggableProduct\r\n                                                    key={product.POS_ProductID}\r\n                                                    product={product}\r\n                                                />\r\n                                            ))}\r\n                                        </ul>\r\n                                    ) : (\r\n                                        <p className=\"text-muted text-center\">\r\n                                            No products available\r\n                                        </p>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Overlay for dragged product */}\r\n                    <DragOverlay>\r\n                        {activeProduct ? (\r\n                            <div className=\"list-group-item d-flex justify-content-between align-items-center bg-light shadow rounded\">\r\n                                {activeProduct.ProductName}\r\n                                <span className=\"badge bg-primary rounded-pill\">\r\n                                    {activeProduct.Price || \"N/A\"}\r\n                                </span>\r\n                            </div>\r\n                        ) : null}\r\n                    </DragOverlay>\r\n                </DndContext>\r\n\r\n                <Modal key={1} show={showModal} onHide={() => setShowModal(false)} centered>\r\n                    <Modal.Header closeButton>\r\n                        <Modal.Title>Add Product to Order</Modal.Title>\r\n                    </Modal.Header>\r\n                    <Modal.Body>\r\n                        <Form>\r\n                            <Form.Group className=\"mb-3\">\r\n                                <Form.Label>Quantity</Form.Label>\r\n                                <Form.Control\r\n                                    type=\"number\"\r\n                                    min=\"1\"\r\n                                    value={quantity}\r\n                                    onChange={(e) => setQuantity(Number(e.target.value))}\r\n                                />\r\n                            </Form.Group>\r\n\r\n                            <Form.Group className=\"mb-3\">\r\n                                <Form.Label>Notes</Form.Label>\r\n                                <Form.Control\r\n                                    as=\"textarea\"\r\n                                    rows={3}\r\n                                    value={notes}\r\n                                    onChange={(e) => setNotes(e.target.value)}\r\n                                />\r\n                            </Form.Group>\r\n                        </Form>\r\n                    </Modal.Body>\r\n                    <Modal.Footer>\r\n                        <Button variant=\"secondary\" onClick={() => setShowModal(false)}>\r\n                            Cancel\r\n                        </Button>\r\n                        <Button variant=\"primary\" onClick={handleSave}>\r\n                            Save\r\n                        </Button>\r\n                    </Modal.Footer>\r\n                </Modal>\r\n\r\n                {modelShow && (\r\n                    <PurchaseOrderForm key={2}\r\n                        onSubmit={handleAddProduct}\r\n                        showModel={modelShow}\r\n                        handleClose={handleClose}\r\n                        data={selectedData}\r\n                        costCenterList={costCenterList}\r\n                    />\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default PurchaseOrderLineTree;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}