{"ast":null,"code":"var _jsxFileName = \"C:\\\\Sandbox\\\\ReactPosTemplate\\\\src\\\\feature-module\\\\menu\\\\menuTreeBuilder.jsx\",\n  _s3 = $RefreshSig$();\nimport React, { useState, useEffect } from \"react\";\nimport { DndContext, useDraggable, useDroppable, DragOverlay } from \"@dnd-kit/core\";\nimport { getMenuTree } from \"../../services/menu/menuService\";\nimport { getAllProducts } from \"../../services/product/product\";\nimport { useParams } from \"react-router-dom\";\nimport { newMenuItemProduct, deleteMenuItemProduct } from \"../../services/menu/menuItemProductService\";\nimport { newMenuItem, updateMenuItem } from \"../../services/menu/menuItemService\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst MenuTreeBuilder = () => {\n  _s3();\n  var _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n  const {\n    id\n  } = useParams();\n  const [menuData, setMenuData] = useState(null);\n  const [productList, setProductList] = useState([]);\n  const [activeProduct, setActiveProduct] = useState(null);\n  const [expandedItems, setExpandedItems] = useState({}); // { parentId: childId }\n  const [parentItemId, setParentItemId] = useState(null);\n  const [showNewModal, setShowNewModal] = useState(false);\n  const [newItemName, setNewItemName] = useState(\"\");\n  const [newItemDesc, setNewItemDesc] = useState(\"\");\n  // Edit modal state\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [editItem, setEditItem] = useState(null);\n  const [editItemName, setEditItemName] = useState(\"\");\n  const [editItemDesc, setEditItemDesc] = useState(\"\");\n  useEffect(() => {\n    if (menuData && menuData.MenuItems && menuData.MenuItems.length > 0) {\n      const expanded = {};\n      function expandAll(items, parentId = 'root') {\n        if (items && items.length > 0) {\n          // If multiple children, open all (store as array)\n          expanded[parentId] = items.map(child => child.ItemID);\n          items.forEach(item => {\n            if (item.ChildItem && item.ChildItem.length > 0) {\n              expandAll(item.ChildItem, item.ItemID);\n            }\n          });\n        }\n      }\n      expandAll(menuData.MenuItems, 'root');\n      setExpandedItems(expanded);\n    }\n  }, [menuData]);\n  useEffect(() => {\n    if (id) {\n      fetchData();\n      fetchProduct();\n    }\n  }, [id]);\n  async function fetchData() {\n    const tree = await getMenuTree(id);\n    setMenuData(tree);\n  }\n  async function fetchProduct() {\n    const products = await getAllProducts();\n    setProductList(products);\n  }\n\n  // dnd-kit droppable for menu item products\n  // Helper to find root parent for a menu item\n  function getRootParentId(menuItems, itemId, parentId = 'root') {\n    for (const item of menuItems) {\n      if (item.ItemID === itemId) return parentId;\n      if (item.ChildItem && item.ChildItem.length > 0) {\n        const found = getRootParentId(item.ChildItem, itemId, item.ItemID);\n        if (found) return found;\n      }\n    }\n    return null;\n  }\n\n  // Only allow drop from right panel (not from menu item to menu item)\n  function DroppableProducts({\n    item,\n    parentId,\n    children\n  }) {\n    _s();\n    const {\n      setNodeRef,\n      isOver\n    } = useDroppable({\n      id: `menu-products-${item.ItemID}`,\n      data: {\n        item,\n        parentId\n      }\n    });\n    // Only allow drop if dragging from right panel (no fromMenuItemId)\n    const canDrop = activeProduct && !activeProduct.fromMenuItemId;\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: setNodeRef,\n      style: {\n        background: isOver && canDrop ? '#e3f2fd' : undefined\n      },\n      children: children(isOver && canDrop)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 13\n    }, this);\n  }\n\n  // dnd-kit draggable for product (only allow drag from right panel, not from menu item)\n  _s(DroppableProducts, \"DmJTTt6A5xWIX/faBiFge3FOLrw=\", false, function () {\n    return [useDroppable];\n  });\n  function DraggableProduct({\n    product,\n    fromMenuItemId\n  }) {\n    _s2();\n    // Only allow drag if not from a menu item (i.e., from right panel)\n    if (fromMenuItemId) {\n      // Render as static, not draggable\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"list-group-item\",\n        style: {\n          cursor: 'default',\n          opacity: 1,\n          backgroundColor: 'rgb(249, 249, 249)'\n        },\n        children: product.ProductName\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 17\n      }, this);\n    }\n    // Draggable for right panel\n    const {\n      attributes,\n      listeners,\n      setNodeRef,\n      isDragging\n    } = useDraggable({\n      id: `product-${product.POS_ProductID}`,\n      data: {\n        product\n      }\n    });\n    React.useEffect(() => {\n      if (isDragging) setActiveProduct(product);else if (activeProduct && activeProduct.POS_ProductID === product.POS_ProductID) setActiveProduct(null);\n    }, [isDragging]);\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: setNodeRef,\n      ...attributes,\n      ...listeners,\n      className: `list-group-item${isDragging ? ' bg-info border border-primary' : ''}`,\n      style: {\n        cursor: 'grab',\n        opacity: isDragging ? 0.5 : 1\n      },\n      children: product.ProductName\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 13\n    }, this);\n  }\n\n  // Accordion: only one expanded per parent, single toggle per item\n  _s2(DraggableProduct, \"6qu6+aenb5ba52lUpmqfo6hhbkg=\", false, function () {\n    return [useDraggable];\n  });\n  const renderMenuTree = (items, level = 0, parentId = 'root') => /*#__PURE__*/_jsxDEV(\"ul\", {\n    className: \"list-group\",\n    style: {\n      marginLeft: level * 10\n    },\n    children: items.map(item => {\n      const hasChildren = item.ChildItem && item.ChildItem.length > 0;\n      // Support expandedItems[parentId] as array (all open)\n      const expandedForParent = expandedItems[parentId];\n      const isExpanded = Array.isArray(expandedForParent) ? expandedForParent.includes(item.ItemID) : expandedForParent === item.ItemID;\n      // Add extra space below top-level parent menu items\n      const isTopLevel = level === 0;\n      return /*#__PURE__*/_jsxDEV(\"li\", {\n        className: `list-group-item${isTopLevel ? ' mb-3 border-1' : 'shadow-sm'}`,\n        style: isTopLevel ? {\n          borderRadius: '8px',\n          boxShadow: '0 0.125rem 0.25rem rgba(0,0,0,.075)'\n        } : {},\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            alignItems: 'center',\n            fontWeight: 600,\n            justifyContent: 'space-between'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              display: 'flex',\n              alignItems: 'center'\n            },\n            children: [(hasChildren || item.Product && item.Product.length > 0) && /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              className: \"btn btn-sm btn-link px-1\",\n              style: {\n                fontSize: '1.1em',\n                marginRight: 4\n              },\n              onClick: () => {\n                setExpandedItems(prev => {\n                  const prevExpanded = prev[parentId];\n                  let newExpanded;\n                  if (Array.isArray(prevExpanded)) {\n                    if (prevExpanded.includes(item.ItemID)) {\n                      newExpanded = prevExpanded.filter(id => id !== item.ItemID);\n                    } else {\n                      newExpanded = [...prevExpanded, item.ItemID];\n                    }\n                  } else {\n                    newExpanded = prevExpanded === item.ItemID ? [] : [item.ItemID];\n                  }\n                  return {\n                    ...prev,\n                    [parentId]: newExpanded\n                  };\n                });\n              },\n              \"aria-label\": isExpanded ? 'Collapse' : 'Expand',\n              children: isExpanded ? /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"-\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 161,\n                columnNumber: 55\n              }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"+\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 161,\n                columnNumber: 72\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 139,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              style: {\n                fontSize: '1.25rem'\n              },\n              children: item.Item\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 164,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              className: \"btn btn-sm btn-link text-primary ms-2 p-0\",\n              title: \"Edit Menu Item\",\n              onClick: () => {\n                setEditItem(item);\n                setEditItemName(item.Item);\n                setEditItemDesc(item.Description || \"\");\n                setShowEditModal(true);\n              },\n              children: /*#__PURE__*/_jsxDEV(\"i\", {\n                className: \"bi bi-pencil-square\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 177,\n                columnNumber: 37\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 166,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 136,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"d-flex align-items-center gap-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn btn-sm btn-outline-success\",\n              onClick: () => openNewItemModal(item.ItemID),\n              title: \"Add child menu item\",\n              children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                className: \"bi bi-plus-circle me-1\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 186,\n                columnNumber: 37\n              }, this), \"Add Sub Item\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 181,\n              columnNumber: 33\n            }, this), level > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"badge bg-info\",\n              children: \"Sub Item\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 190,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 25\n        }, this), isExpanded && /*#__PURE__*/_jsxDEV(DroppableProducts, {\n          item: item,\n          parentId: parentId,\n          children: isOver => /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              style: {\n                fontWeight: 500\n              },\n              children: \"Products:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 199,\n              columnNumber: 41\n            }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n              className: \"list-unstyled mb-2\",\n              style: {\n                minHeight: 32,\n                background: isOver ? '#bbf7d0' : undefined,\n                border: isOver ? '2px dashed #007bff' : undefined\n              },\n              children: [isOver && activeProduct && /*#__PURE__*/_jsxDEV(\"li\", {\n                className: \"list-group-item list-group-item-success\",\n                children: /*#__PURE__*/_jsxDEV(\"span\", {\n                  style: {\n                    fontWeight: 500\n                  },\n                  children: [\"Drop \", /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"text-primary\",\n                    children: activeProduct.ProductName\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 203,\n                    columnNumber: 92\n                  }, this), \" here\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 203,\n                  columnNumber: 53\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 202,\n                columnNumber: 49\n              }, this), item.Product && item.Product.length > 0 ? item.Product.map(prod => /*#__PURE__*/_jsxDEV(\"li\", {\n                className: \"mb-1 d-flex align-items-center justify-content-between\",\n                style: {\n                  border: \"1px solid #dee2e6\",\n                  borderRadius: \"5px\",\n                  padding: \"6px 10px\",\n                  background: \"#f9f9f9\"\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  style: {\n                    fontWeight: 400\n                  },\n                  children: prod.ProductName || prod.Product\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 209,\n                  columnNumber: 57\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"button\",\n                  className: \"btn btn-sm btn-link text-danger ms-2 p-0\",\n                  title: \"Delete\",\n                  onClick: async () => {\n                    if (window.confirm('Are you sure you want to delete this product?')) {\n                      // Call API to delete product from menu item\n                      await deleteMenuItemProduct(prod.POS_MenuItemProductID);\n                      // Update local state after successful delete\n                      setMenuData(prev => {\n                        function removeProduct(items) {\n                          return items.map(menuItem => {\n                            if (menuItem.ItemID === item.ItemID && menuItem.Product) {\n                              menuItem.Product = menuItem.Product.filter(p => p.POS_MenuItemProductID !== prod.POS_MenuItemProductID);\n                            }\n                            if (menuItem.ChildItem && menuItem.ChildItem.length > 0) {\n                              menuItem.ChildItem = removeProduct(menuItem.ChildItem);\n                            }\n                            return menuItem;\n                          });\n                        }\n                        return {\n                          ...prev,\n                          MenuItems: removeProduct(prev.MenuItems)\n                        };\n                      });\n                    }\n                  },\n                  children: /*#__PURE__*/_jsxDEV(\"i\", {\n                    className: \"bi bi-trash\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 231,\n                    columnNumber: 61\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 210,\n                  columnNumber: 57\n                }, this)]\n              }, prod.ProductID || prod.POS_ProductID, true, {\n                fileName: _jsxFileName,\n                lineNumber: 208,\n                columnNumber: 53\n              }, this)) : /*#__PURE__*/_jsxDEV(\"li\", {\n                className: \"text-muted\",\n                children: isOver ? \"Drop product here...\" : \"No products assigned\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 236,\n                columnNumber: 49\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 200,\n              columnNumber: 41\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 198,\n            columnNumber: 37\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 29\n        }, this), hasChildren && isExpanded && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-3 p-2 shadow-sm mt-1\",\n          style: {\n            borderRadius: '8px',\n            border: '1px solid #dee2e6'\n          },\n          children: renderMenuTree(item.ChildItem, level + 1, item.ItemID)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 247,\n          columnNumber: 29\n        }, this)]\n      }, item.ItemID, true, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 21\n      }, this);\n    })\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 123,\n    columnNumber: 9\n  }, this);\n\n  // Only allow drag from right panel to menu item (not menu item to menu item)\n  const handleDragEnd = event => {\n    const {\n      active,\n      over\n    } = event;\n    if (!active || !over) return;\n    // Only allow dropping product into menu-products-* from right panel\n    if (active.id.startsWith('product-') && over.id.startsWith('menu-products-')) {\n      // Only allow if not dragging from a menu item\n      const match = active.id.match(/^product-(\\d+)(?:-from-(\\d+))?$/);\n      if (!match) return;\n      const productId = parseInt(match[1]);\n      const fromMenuItemId = match[2] ? parseInt(match[2]) : null;\n      if (fromMenuItemId) return; // Prevent drop from menu item to menu item\n      const menuItemId = parseInt(over.id.replace('menu-products-', ''));\n      // Find product in right panel\n      const draggedProduct = productList.find(p => p.POS_ProductID === productId);\n      if (!draggedProduct) return;\n      // Add to target menu and call API\n      async function addProduct(items) {\n        return Promise.all(items.map(async item => {\n          if (item.ItemID === menuItemId) {\n            const alreadyExists = item.Product && item.Product.some(p => p.ProductID === productId || p.POS_ProductID === productId);\n            if (!alreadyExists) {\n              // Call API to add product to menu item\n              await newMenuItemProduct({\n                FK_MenuItemID: menuItemId,\n                FK_ProductID: draggedProduct.ProductID || draggedProduct.POS_ProductID\n              });\n              const newProd = {\n                POS_MenuItemProductID: Math.random(),\n                // temp ID\n                ProductID: draggedProduct.ProductID || draggedProduct.POS_ProductID,\n                Product: draggedProduct.ProductName || draggedProduct.Product\n              };\n              item.Product = item.Product ? [...item.Product, newProd] : [newProd];\n            }\n          }\n          if (item.ChildItem && item.ChildItem.length > 0) {\n            item.ChildItem = await addProduct(item.ChildItem);\n          }\n          return item;\n        }));\n      }\n      (async () => {\n        const updatedMenuItems = await addProduct(menuData.MenuItems);\n        setMenuData(prev => ({\n          ...prev,\n          MenuItems: updatedMenuItems\n        }));\n      })();\n    }\n  };\n  const openNewItemModal = (parentId = null) => {\n    setParentItemId(parentId);\n    setShowNewModal(true);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"page-wrapper\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"content\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"page-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"add-item d-flex\",\n          children: /*#__PURE__*/_jsxDEV(\"h4\", {\n            className: \"mb-1\",\n            children: menuData ? `${menuData.MenuName} Menu` : \"Menu Tree\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 313,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 312,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"page-btn\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn btn-success mb-3\",\n            onClick: () => openNewItemModal(),\n            children: \"Add New Menu Item\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 316,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 315,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 311,\n        columnNumber: 17\n      }, this), showNewModal && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"modal fade show\",\n        style: {\n          display: 'block',\n          background: 'rgba(0,0,0,0.3)'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"modal-dialog\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"modal-content\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"modal-header\",\n              children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n                className: \"modal-title\",\n                children: parentItemId ? 'Add Sub Menu Item' : 'Add New Menu Item'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 324,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: \"btn-close\",\n                onClick: () => {\n                  setShowNewModal(false);\n                  setParentItemId(null);\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 327,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 323,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n              onSubmit: async e => {\n                e.preventDefault();\n                if (!newItemName.trim()) return;\n                // Call newMenuItem service\n                const payload = {\n                  FK_MenuID: (menuData === null || menuData === void 0 ? void 0 : menuData.MenuID) || 0,\n                  Item: newItemName,\n                  Description: newItemDesc,\n                  FK_POS_MenuItemID: parentItemId // Use the parent item ID\n                };\n                try {\n                  const res = await newMenuItem(payload);\n                  debugger;\n                  if (res.Success) {\n                    await fetchData();\n                    setShowNewModal(false);\n                    setNewItemName(\"\");\n                    setNewItemDesc(\"\");\n                    setParentItemId(null);\n                  } else {\n                    var _res$Messages;\n                    alert(((_res$Messages = res.Messages) === null || _res$Messages === void 0 ? void 0 : _res$Messages[0]) || \"Something went wrong.\");\n                  }\n                } catch (err) {\n                  alert(\"Error adding menu item.\");\n                }\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"modal-body\",\n                children: [parentItemId && /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"alert alert-info mb-3\",\n                  children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                    className: \"bi bi-info-circle me-2\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 361,\n                    columnNumber: 49\n                  }, this), \"This will be added as a sub-item under the selected menu item.\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 360,\n                  columnNumber: 45\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"text\",\n                  className: \"form-control mb-2\",\n                  placeholder: \"Menu item name\",\n                  value: newItemName,\n                  onChange: e => setNewItemName(e.target.value)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 365,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"text\",\n                  className: \"form-control\",\n                  placeholder: \"Description\",\n                  value: newItemDesc,\n                  onChange: e => setNewItemDesc(e.target.value)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 372,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 358,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"modal-footer\",\n                children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"button\",\n                  className: \"btn btn-secondary\",\n                  onClick: () => {\n                    setShowNewModal(false);\n                    setParentItemId(null);\n                  },\n                  children: \"Cancel\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 381,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"submit\",\n                  className: \"btn btn-primary\",\n                  children: \"Add\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 385,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 380,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 332,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 322,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 321,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 21\n      }, this), showEditModal && editItem && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"modal fade show\",\n        style: {\n          display: 'block',\n          background: 'rgba(0,0,0,0.3)'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"modal-dialog\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"modal-content\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"modal-header\",\n              children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n                className: \"modal-title\",\n                children: \"Edit Menu Item\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 399,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: \"btn-close\",\n                onClick: () => {\n                  setShowEditModal(false);\n                  setEditItem(null);\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 400,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 398,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n              onSubmit: async e => {\n                e.preventDefault();\n                if (!editItemName.trim()) return;\n                // Prepare payload for updateMenuItem\n                const payload = {\n                  POS_MenuItemID: editItem.ItemID,\n                  FK_MenuID: (menuData === null || menuData === void 0 ? void 0 : menuData.MenuID) || 0,\n                  Item: editItemName,\n                  Description: editItemDesc,\n                  FK_POS_MenuItemID: editItem.FK_POS_MenuItemID || null\n                };\n                debugger;\n                try {\n                  const res = await updateMenuItem(payload);\n                  debugger;\n                  if (res.Success) {\n                    await fetchData();\n                    setShowEditModal(false);\n                    setEditItem(null);\n                  } else {\n                    var _res$Messages2;\n                    alert(((_res$Messages2 = res.Messages) === null || _res$Messages2 === void 0 ? void 0 : _res$Messages2[0]) || \"Something went wrong.\");\n                  }\n                } catch (err) {\n                  alert(\"Error updating menu item.\");\n                }\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"modal-body\",\n                children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"text\",\n                  className: \"form-control mb-2\",\n                  placeholder: \"Menu item name\",\n                  value: editItemName,\n                  onChange: e => setEditItemName(e.target.value)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 432,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"text\",\n                  className: \"form-control\",\n                  placeholder: \"Description\",\n                  value: editItemDesc,\n                  onChange: e => setEditItemDesc(e.target.value)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 439,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 431,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"modal-footer\",\n                children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"button\",\n                  className: \"btn btn-secondary\",\n                  onClick: () => {\n                    setShowEditModal(false);\n                    setEditItem(null);\n                  },\n                  children: \"Cancel\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 448,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"submit\",\n                  className: \"btn btn-primary\",\n                  children: \"Update\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 452,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 447,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 405,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 397,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 396,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 395,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(DndContext, {\n        onDragEnd: handleDragEnd,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"row\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-md-7\",\n            style: {\n              maxHeight: '70vh',\n              overflowY: 'auto'\n            },\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"mb-3\",\n              children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n                className: \"mb-3\",\n                children: \"Menu Items\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 465,\n                columnNumber: 33\n              }, this), menuData && menuData.MenuItems ? renderMenuTree(menuData.MenuItems, 0, 'root') : /*#__PURE__*/_jsxDEV(\"p\", {\n                children: \"Loading menu...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 469,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 464,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 463,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-md-5\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"card shadow-sm\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"card-header bg-white\",\n                children: /*#__PURE__*/_jsxDEV(\"h5\", {\n                  className: \"mb-0\",\n                  children: \"All Products\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 478,\n                  columnNumber: 37\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 477,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  maxHeight: '70vh',\n                  overflowY: 'auto',\n                  padding: '16px'\n                },\n                children: [productList && productList.length > 0 ? /*#__PURE__*/_jsxDEV(\"ul\", {\n                  className: \"list-group\",\n                  children: productList.map(product => /*#__PURE__*/_jsxDEV(DraggableProduct, {\n                    product: product\n                  }, product.POS_ProductID, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 484,\n                    columnNumber: 49\n                  }, this))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 482,\n                  columnNumber: 41\n                }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"text-muted\",\n                  children: \"No products available\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 488,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(DragOverlay, {\n                  children: activeProduct ? /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"list-group-item bg-primary text-white border border-primary\",\n                    style: {\n                      fontWeight: 600,\n                      fontSize: '1.1em',\n                      boxShadow: '0 2px 8px rgba(0,0,0,0.15)'\n                    },\n                    children: [\"Dragging: \", activeProduct.ProductName]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 492,\n                    columnNumber: 45\n                  }, this) : null\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 490,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 480,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 476,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 475,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 461,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 460,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 310,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 309,\n    columnNumber: 9\n  }, this);\n};\n_s3(MenuTreeBuilder, \"/IoDFI/v2nq4e5nSPQWYNruU/M4=\", false, function () {\n  return [useParams];\n});\n_c = MenuTreeBuilder;\nexport default MenuTreeBuilder;\nvar _c;\n$RefreshReg$(_c, \"MenuTreeBuilder\");","map":{"version":3,"names":["React","useState","useEffect","DndContext","useDraggable","useDroppable","DragOverlay","getMenuTree","getAllProducts","useParams","newMenuItemProduct","deleteMenuItemProduct","newMenuItem","updateMenuItem","jsxDEV","_jsxDEV","MenuTreeBuilder","_s3","_s","$RefreshSig$","_s2","id","menuData","setMenuData","productList","setProductList","activeProduct","setActiveProduct","expandedItems","setExpandedItems","parentItemId","setParentItemId","showNewModal","setShowNewModal","newItemName","setNewItemName","newItemDesc","setNewItemDesc","showEditModal","setShowEditModal","editItem","setEditItem","editItemName","setEditItemName","editItemDesc","setEditItemDesc","MenuItems","length","expanded","expandAll","items","parentId","map","child","ItemID","forEach","item","ChildItem","fetchData","fetchProduct","tree","products","getRootParentId","menuItems","itemId","found","DroppableProducts","children","setNodeRef","isOver","data","canDrop","fromMenuItemId","ref","style","background","undefined","fileName","_jsxFileName","lineNumber","columnNumber","DraggableProduct","product","className","cursor","opacity","backgroundColor","ProductName","attributes","listeners","isDragging","POS_ProductID","renderMenuTree","level","marginLeft","hasChildren","expandedForParent","isExpanded","Array","isArray","includes","isTopLevel","borderRadius","boxShadow","display","alignItems","fontWeight","justifyContent","Product","type","fontSize","marginRight","onClick","prev","prevExpanded","newExpanded","filter","Item","title","Description","openNewItemModal","minHeight","border","prod","padding","window","confirm","POS_MenuItemProductID","removeProduct","menuItem","p","ProductID","handleDragEnd","event","active","over","startsWith","match","productId","parseInt","menuItemId","replace","draggedProduct","find","addProduct","Promise","all","alreadyExists","some","FK_MenuItemID","FK_ProductID","newProd","Math","random","updatedMenuItems","MenuName","onSubmit","e","preventDefault","trim","payload","FK_MenuID","MenuID","FK_POS_MenuItemID","res","Success","_res$Messages","alert","Messages","err","placeholder","value","onChange","target","POS_MenuItemID","_res$Messages2","onDragEnd","maxHeight","overflowY","_c","$RefreshReg$"],"sources":["C:/Sandbox/ReactPosTemplate/src/feature-module/menu/menuTreeBuilder.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { DndContext, useDraggable, useDroppable, DragOverlay } from \"@dnd-kit/core\";\r\nimport { getMenuTree } from \"../../services/menu/menuService\";\r\nimport { getAllProducts } from \"../../services/product/product\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport { newMenuItemProduct, deleteMenuItemProduct } from \"../../services/menu/menuItemProductService\";\r\nimport { newMenuItem, updateMenuItem } from \"../../services/menu/menuItemService\";\r\n\r\nconst MenuTreeBuilder = () => {\r\n    const { id } = useParams();\r\n    const [menuData, setMenuData] = useState(null);\r\n    const [productList, setProductList] = useState([]);\r\n    const [activeProduct, setActiveProduct] = useState(null);\r\n    const [expandedItems, setExpandedItems] = useState({}); // { parentId: childId }\r\n    const [parentItemId, setParentItemId] = useState(null);\r\n    const [showNewModal, setShowNewModal] = useState(false);\r\n    const [newItemName, setNewItemName] = useState(\"\");\r\n    const [newItemDesc, setNewItemDesc] = useState(\"\");\r\n    // Edit modal state\r\n    const [showEditModal, setShowEditModal] = useState(false);\r\n    const [editItem, setEditItem] = useState(null);\r\n    const [editItemName, setEditItemName] = useState(\"\");\r\n    const [editItemDesc, setEditItemDesc] = useState(\"\");\r\n    useEffect(() => {\r\n        if (menuData && menuData.MenuItems && menuData.MenuItems.length > 0) {\r\n            const expanded = {};\r\n            function expandAll(items, parentId = 'root') {\r\n                if (items && items.length > 0) {\r\n                    // If multiple children, open all (store as array)\r\n                    expanded[parentId] = items.map(child => child.ItemID);\r\n                    items.forEach(item => {\r\n                        if (item.ChildItem && item.ChildItem.length > 0) {\r\n                            expandAll(item.ChildItem, item.ItemID);\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n            expandAll(menuData.MenuItems, 'root');\r\n            setExpandedItems(expanded);\r\n        }\r\n    }, [menuData]);\r\n\r\n    useEffect(() => {\r\n\r\n        if (id) {\r\n            fetchData();\r\n            fetchProduct();\r\n        }\r\n    }, [id]);\r\n\r\n    async function fetchData() {\r\n        const tree = await getMenuTree(id);\r\n        setMenuData(tree);\r\n    }\r\n    async function fetchProduct() {\r\n        const products = await getAllProducts();\r\n        setProductList(products);\r\n    }\r\n\r\n    // dnd-kit droppable for menu item products\r\n    // Helper to find root parent for a menu item\r\n    function getRootParentId(menuItems, itemId, parentId = 'root') {\r\n        for (const item of menuItems) {\r\n            if (item.ItemID === itemId) return parentId;\r\n            if (item.ChildItem && item.ChildItem.length > 0) {\r\n                const found = getRootParentId(item.ChildItem, itemId, item.ItemID);\r\n                if (found) return found;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    // Only allow drop from right panel (not from menu item to menu item)\r\n    function DroppableProducts({ item, parentId, children }) {\r\n        const { setNodeRef, isOver } = useDroppable({\r\n            id: `menu-products-${item.ItemID}`,\r\n            data: { item, parentId }\r\n        });\r\n        // Only allow drop if dragging from right panel (no fromMenuItemId)\r\n        const canDrop = activeProduct && !activeProduct.fromMenuItemId;\r\n        return (\r\n            <div ref={setNodeRef} style={{ background: isOver && canDrop ? '#e3f2fd' : undefined }}>\r\n                {children(isOver && canDrop)}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // dnd-kit draggable for product (only allow drag from right panel, not from menu item)\r\n    function DraggableProduct({ product, fromMenuItemId }) {\r\n        // Only allow drag if not from a menu item (i.e., from right panel)\r\n        if (fromMenuItemId) {\r\n            // Render as static, not draggable\r\n            return (\r\n                <div className=\"list-group-item\" style={{ cursor: 'default', opacity: 1, backgroundColor: 'rgb(249, 249, 249)' }}>\r\n                    {product.ProductName}\r\n                </div>\r\n            );\r\n        }\r\n        // Draggable for right panel\r\n        const { attributes, listeners, setNodeRef, isDragging } = useDraggable({\r\n            id: `product-${product.POS_ProductID}`,\r\n            data: { product }\r\n        });\r\n        React.useEffect(() => {\r\n            if (isDragging) setActiveProduct(product);\r\n            else if (activeProduct && activeProduct.POS_ProductID === product.POS_ProductID) setActiveProduct(null);\r\n        }, [isDragging]);\r\n        return (\r\n            <div\r\n                ref={setNodeRef}\r\n                {...attributes}\r\n                {...listeners}\r\n                className={`list-group-item${isDragging ? ' bg-info border border-primary' : ''}`}\r\n                style={{ cursor: 'grab', opacity: isDragging ? 0.5 : 1 }}\r\n            >\r\n                {product.ProductName}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Accordion: only one expanded per parent, single toggle per item\r\n    const renderMenuTree = (items, level = 0, parentId = 'root') => (\r\n        <ul className=\"list-group\" style={{ marginLeft: level * 10 }}>\r\n            {items.map(item => {\r\n                const hasChildren = item.ChildItem && item.ChildItem.length > 0;\r\n                // Support expandedItems[parentId] as array (all open)\r\n                const expandedForParent = expandedItems[parentId];\r\n                const isExpanded = Array.isArray(expandedForParent)\r\n                    ? expandedForParent.includes(item.ItemID)\r\n                    : expandedForParent === item.ItemID;\r\n                // Add extra space below top-level parent menu items\r\n                const isTopLevel = level === 0;\r\n                return (\r\n                    <li key={item.ItemID} className={`list-group-item${isTopLevel ? ' mb-3 border-1' : 'shadow-sm'}`} style={isTopLevel ? { borderRadius: '8px', boxShadow: '0 0.125rem 0.25rem rgba(0,0,0,.075)' } : {}}>\r\n                        <div style={{ display: 'flex', alignItems: 'center', fontWeight: 600, justifyContent: 'space-between' }}>\r\n                            <div style={{ display: 'flex', alignItems: 'center' }}>\r\n                                {/* Single toggle for both children and products */}\r\n                                {(hasChildren || (item.Product && item.Product.length > 0)) && (\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        className=\"btn btn-sm btn-link px-1\"\r\n                                        style={{ fontSize: '1.1em', marginRight: 4 }}\r\n                                        onClick={() => {\r\n                                            setExpandedItems(prev => {\r\n                                                const prevExpanded = prev[parentId];\r\n                                                let newExpanded;\r\n                                                if (Array.isArray(prevExpanded)) {\r\n                                                    if (prevExpanded.includes(item.ItemID)) {\r\n                                                        newExpanded = prevExpanded.filter(id => id !== item.ItemID);\r\n                                                    } else {\r\n                                                        newExpanded = [...prevExpanded, item.ItemID];\r\n                                                    }\r\n                                                } else {\r\n                                                    newExpanded = prevExpanded === item.ItemID ? [] : [item.ItemID];\r\n                                                }\r\n                                                return { ...prev, [parentId]: newExpanded };\r\n                                            });\r\n                                        }}\r\n                                        aria-label={isExpanded ? 'Collapse' : 'Expand'}\r\n                                    >\r\n                                        {isExpanded ? <span>-</span> : <span>+</span>}\r\n                                    </button>\r\n                                )}\r\n                                <span style={{ fontSize: '1.25rem' }}>{item.Item}</span>\r\n                                {/* Edit icon button */}\r\n                                <button\r\n                                    type=\"button\"\r\n                                    className=\"btn btn-sm btn-link text-primary ms-2 p-0\"\r\n                                    title=\"Edit Menu Item\"\r\n                                    onClick={() => {\r\n                                        setEditItem(item);\r\n                                        setEditItemName(item.Item);\r\n                                        setEditItemDesc(item.Description || \"\");\r\n                                        setShowEditModal(true);\r\n                                    }}\r\n                                >\r\n                                    <i className=\"bi bi-pencil-square\"></i>\r\n                                </button>\r\n                            </div>\r\n                            <div className=\"d-flex align-items-center gap-2\">\r\n                                <button\r\n                                    className=\"btn btn-sm btn-outline-success\"\r\n                                    onClick={() => openNewItemModal(item.ItemID)}\r\n                                    title=\"Add child menu item\"\r\n                                >\r\n                                    <i className=\"bi bi-plus-circle me-1\"></i>\r\n                                    Add Sub Item\r\n                                </button>\r\n                                {level > 0 && (\r\n                                    <span className=\"badge bg-info\">Sub Item</span>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                        {/* Products for this item - droppable, collapsible */}\r\n                        {isExpanded && (\r\n                            <DroppableProducts item={item} parentId={parentId}>\r\n                                {(isOver) => (\r\n                                    <div>\r\n                                        <span style={{ fontWeight: 500 }}>Products:</span>\r\n                                        <ul className=\"list-unstyled mb-2\" style={{ minHeight: 32, background: isOver ? '#bbf7d0' : undefined, border: isOver ? '2px dashed #007bff' : undefined }}>\r\n                                            {isOver && activeProduct && (\r\n                                                <li className=\"list-group-item list-group-item-success\">\r\n                                                    <span style={{ fontWeight: 500 }}>Drop <span className=\"text-primary\">{activeProduct.ProductName}</span> here</span>\r\n                                                </li>\r\n                                            )}\r\n                                            {item.Product && item.Product.length > 0 ? (\r\n                                                item.Product.map((prod) => (\r\n                                                    <li key={prod.ProductID || prod.POS_ProductID} className=\"mb-1 d-flex align-items-center justify-content-between\" style={{ border: \"1px solid #dee2e6\", borderRadius: \"5px\", padding: \"6px 10px\", background: \"#f9f9f9\" }}>\r\n                                                        <span style={{ fontWeight: 400 }}>{prod.ProductName || prod.Product}</span>\r\n                                                        <button type=\"button\" className=\"btn btn-sm btn-link text-danger ms-2 p-0\" title=\"Delete\" onClick={async () => {\r\n                                                            if (window.confirm('Are you sure you want to delete this product?')) {\r\n                                                                // Call API to delete product from menu item\r\n                                                                await deleteMenuItemProduct(prod.POS_MenuItemProductID);\r\n                                                                // Update local state after successful delete\r\n                                                                setMenuData(prev => {\r\n                                                                    function removeProduct(items) {\r\n                                                                        return items.map(menuItem => {\r\n                                                                            if (menuItem.ItemID === item.ItemID && menuItem.Product) {\r\n                                                                                menuItem.Product = menuItem.Product.filter(p => (p.POS_MenuItemProductID !== prod.POS_MenuItemProductID));\r\n                                                                            }\r\n                                                                            if (menuItem.ChildItem && menuItem.ChildItem.length > 0) {\r\n                                                                                menuItem.ChildItem = removeProduct(menuItem.ChildItem);\r\n                                                                            }\r\n                                                                            return menuItem;\r\n                                                                        });\r\n                                                                    }\r\n                                                                    return { ...prev, MenuItems: removeProduct(prev.MenuItems) };\r\n                                                                });\r\n                                                            }\r\n                                                        }}>\r\n                                                            <i className=\"bi bi-trash\"></i>\r\n                                                        </button>\r\n                                                    </li>\r\n                                                ))\r\n                                            ) : (\r\n                                                <li className=\"text-muted\">\r\n                                                    {isOver ? \"Drop product here...\" : \"No products assigned\"}\r\n                                                </li>\r\n                                            )}\r\n                                        </ul>\r\n                                    </div>\r\n                                )}\r\n                            </DroppableProducts>\r\n                        )}\r\n                        {/* Child items - collapsible */}\r\n                        {hasChildren && isExpanded && (\r\n                            <div className=\"ms-3 p-2 shadow-sm mt-1\" style={{ borderRadius: '8px', border: '1px solid #dee2e6' }}>\r\n                                {renderMenuTree(item.ChildItem, level + 1, item.ItemID)}\r\n                            </div>\r\n                        )}\r\n                    </li>\r\n                );\r\n            })}\r\n        </ul>\r\n    );\r\n\r\n    // Only allow drag from right panel to menu item (not menu item to menu item)\r\n    const handleDragEnd = (event) => {\r\n        const { active, over } = event;\r\n        if (!active || !over) return;\r\n        // Only allow dropping product into menu-products-* from right panel\r\n        if (active.id.startsWith('product-') && over.id.startsWith('menu-products-')) {\r\n            // Only allow if not dragging from a menu item\r\n            const match = active.id.match(/^product-(\\d+)(?:-from-(\\d+))?$/);\r\n            if (!match) return;\r\n            const productId = parseInt(match[1]);\r\n            const fromMenuItemId = match[2] ? parseInt(match[2]) : null;\r\n            if (fromMenuItemId) return; // Prevent drop from menu item to menu item\r\n            const menuItemId = parseInt(over.id.replace('menu-products-', ''));\r\n            // Find product in right panel\r\n            const draggedProduct = productList.find(p => p.POS_ProductID === productId);\r\n            if (!draggedProduct) return;\r\n            // Add to target menu and call API\r\n            async function addProduct(items) {\r\n                return Promise.all(items.map(async item => {\r\n                    if (item.ItemID === menuItemId) {\r\n                        const alreadyExists = item.Product && item.Product.some(p => (p.ProductID === productId || p.POS_ProductID === productId));\r\n                        if (!alreadyExists) {\r\n                            // Call API to add product to menu item\r\n                            await newMenuItemProduct({ FK_MenuItemID: menuItemId, FK_ProductID: draggedProduct.ProductID || draggedProduct.POS_ProductID });\r\n                            const newProd = {\r\n                                POS_MenuItemProductID: Math.random(), // temp ID\r\n                                ProductID: draggedProduct.ProductID || draggedProduct.POS_ProductID,\r\n                                Product: draggedProduct.ProductName || draggedProduct.Product\r\n                            };\r\n                            item.Product = item.Product ? [...item.Product, newProd] : [newProd];\r\n                        }\r\n                    }\r\n                    if (item.ChildItem && item.ChildItem.length > 0) {\r\n                        item.ChildItem = await addProduct(item.ChildItem);\r\n                    }\r\n                    return item;\r\n                }));\r\n            }\r\n            (async () => {\r\n                const updatedMenuItems = await addProduct(menuData.MenuItems);\r\n                setMenuData(prev => ({ ...prev, MenuItems: updatedMenuItems }));\r\n            })();\r\n        }\r\n    };\r\n\r\n    const openNewItemModal = (parentId = null) => {\r\n        setParentItemId(parentId);\r\n        setShowNewModal(true);\r\n    };\r\n\r\n\r\n    return (\r\n        <div className=\"page-wrapper\">\r\n            <div className=\"content\">\r\n                <div className=\"page-header\">\r\n                    <div className=\"add-item d-flex\">\r\n                        <h4 className=\"mb-1\">{menuData ? `${menuData.MenuName} Menu` : \"Menu Tree\"}</h4>\r\n                    </div>\r\n                    <div className=\"page-btn\">\r\n                        <button className=\"btn btn-success mb-3\" onClick={() => openNewItemModal()}>Add New Menu Item</button>\r\n                    </div>\r\n                </div>\r\n                {showNewModal && (\r\n                    <div className=\"modal fade show\" style={{ display: 'block', background: 'rgba(0,0,0,0.3)' }}>\r\n                        <div className=\"modal-dialog\">\r\n                            <div className=\"modal-content\">\r\n                                <div className=\"modal-header\">\r\n                                    <h5 className=\"modal-title\">\r\n                                        {parentItemId ? 'Add Sub Menu Item' : 'Add New Menu Item'}\r\n                                    </h5>\r\n                                    <button type=\"button\" className=\"btn-close\" onClick={() => {\r\n                                        setShowNewModal(false);\r\n                                        setParentItemId(null);\r\n                                    }}></button>\r\n                                </div>\r\n                                <form onSubmit={async e => {\r\n                                    e.preventDefault();\r\n                                    if (!newItemName.trim()) return;\r\n                                    // Call newMenuItem service\r\n                                    const payload = {\r\n                                        FK_MenuID: menuData?.MenuID || 0,\r\n                                        Item: newItemName,\r\n                                        Description: newItemDesc,\r\n                                        FK_POS_MenuItemID: parentItemId // Use the parent item ID\r\n                                    };\r\n                                    try {\r\n                                        const res = await newMenuItem(payload);\r\n                                        debugger;\r\n                                        if (res.Success) {\r\n                                            await fetchData();\r\n                                            setShowNewModal(false);\r\n                                            setNewItemName(\"\");\r\n                                            setNewItemDesc(\"\");\r\n                                            setParentItemId(null);\r\n                                        } else {\r\n                                            alert(res.Messages?.[0] || \"Something went wrong.\");\r\n                                        }\r\n                                    } catch (err) {\r\n                                        alert(\"Error adding menu item.\");\r\n                                    }\r\n                                }}>\r\n                                    <div className=\"modal-body\">\r\n                                        {parentItemId && (\r\n                                            <div className=\"alert alert-info mb-3\">\r\n                                                <i className=\"bi bi-info-circle me-2\"></i>\r\n                                                This will be added as a sub-item under the selected menu item.\r\n                                            </div>\r\n                                        )}\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            className=\"form-control mb-2\"\r\n                                            placeholder=\"Menu item name\"\r\n                                            value={newItemName}\r\n                                            onChange={e => setNewItemName(e.target.value)}\r\n                                        />\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            className=\"form-control\"\r\n                                            placeholder=\"Description\"\r\n                                            value={newItemDesc}\r\n                                            onChange={e => setNewItemDesc(e.target.value)}\r\n                                        />\r\n                                    </div>\r\n                                    <div className=\"modal-footer\">\r\n                                        <button type=\"button\" className=\"btn btn-secondary\" onClick={() => {\r\n                                            setShowNewModal(false);\r\n                                            setParentItemId(null);\r\n                                        }}>Cancel</button>\r\n                                        <button type=\"submit\" className=\"btn btn-primary\">Add</button>\r\n                                    </div>\r\n                                </form>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Edit Menu Item Modal */}\r\n                {showEditModal && editItem && (\r\n                    <div className=\"modal fade show\" style={{ display: 'block', background: 'rgba(0,0,0,0.3)' }}>\r\n                        <div className=\"modal-dialog\">\r\n                            <div className=\"modal-content\">\r\n                                <div className=\"modal-header\">\r\n                                    <h5 className=\"modal-title\">Edit Menu Item</h5>\r\n                                    <button type=\"button\" className=\"btn-close\" onClick={() => {\r\n                                        setShowEditModal(false);\r\n                                        setEditItem(null);\r\n                                    }}></button>\r\n                                </div>\r\n                                <form onSubmit={async e => {\r\n                                    e.preventDefault();\r\n                                    if (!editItemName.trim()) return;\r\n                                    // Prepare payload for updateMenuItem\r\n                                    const payload = {\r\n                                        POS_MenuItemID: editItem.ItemID,\r\n                                        FK_MenuID: menuData?.MenuID || 0,\r\n                                        Item: editItemName,\r\n                                        Description: editItemDesc,\r\n                                        FK_POS_MenuItemID: editItem.FK_POS_MenuItemID || null\r\n                                    };\r\n                                    debugger;\r\n                                    try {\r\n                                        const res = await updateMenuItem(payload);\r\n                                        debugger;\r\n                                        if (res.Success) {\r\n                                            await fetchData();\r\n                                            setShowEditModal(false);\r\n                                            setEditItem(null);\r\n                                        } else {\r\n                                            alert(res.Messages?.[0] || \"Something went wrong.\");\r\n                                        }\r\n                                    } catch (err) {\r\n                                        alert(\"Error updating menu item.\");\r\n                                    }\r\n                                }}>\r\n                                    <div className=\"modal-body\">\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            className=\"form-control mb-2\"\r\n                                            placeholder=\"Menu item name\"\r\n                                            value={editItemName}\r\n                                            onChange={e => setEditItemName(e.target.value)}\r\n                                        />\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            className=\"form-control\"\r\n                                            placeholder=\"Description\"\r\n                                            value={editItemDesc}\r\n                                            onChange={e => setEditItemDesc(e.target.value)}\r\n                                        />\r\n                                    </div>\r\n                                    <div className=\"modal-footer\">\r\n                                        <button type=\"button\" className=\"btn btn-secondary\" onClick={() => {\r\n                                            setShowEditModal(false);\r\n                                            setEditItem(null);\r\n                                        }}>Cancel</button>\r\n                                        <button type=\"submit\" className=\"btn btn-primary\">Update</button>\r\n                                    </div>\r\n                                </form>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                <DndContext onDragEnd={handleDragEnd}>\r\n                    <div className=\"row\">\r\n                        {/* Left: Menu Tree */}\r\n                        <div className=\"col-md-7\" style={{ maxHeight: '70vh', overflowY: 'auto' }}>\r\n                            <div className=\"mb-3\">\r\n                                <h5 className=\"mb-3\">Menu Items</h5>\r\n                                {menuData && menuData.MenuItems ? (\r\n                                    renderMenuTree(menuData.MenuItems, 0, 'root')\r\n                                ) : (\r\n                                    <p>Loading menu...</p>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Right: Products */}\r\n                        <div className=\"col-md-5\">\r\n                            <div className=\"card shadow-sm\">\r\n                                <div className=\"card-header bg-white\">\r\n                                    <h5 className=\"mb-0\">All Products</h5>\r\n                                </div>\r\n                                <div style={{ maxHeight: '70vh', overflowY: 'auto', padding: '16px' }}>\r\n                                    {(productList && productList.length > 0) ? (\r\n                                        <ul className=\"list-group\">\r\n                                            {productList.map(product => (\r\n                                                <DraggableProduct product={product} key={product.POS_ProductID} />\r\n                                            ))}\r\n                                        </ul>\r\n                                    ) : (\r\n                                        <div className=\"text-muted\">No products available</div>\r\n                                    )}\r\n                                    <DragOverlay>\r\n                                        {activeProduct ? (\r\n                                            <div className=\"list-group-item bg-primary text-white border border-primary\" style={{ fontWeight: 600, fontSize: '1.1em', boxShadow: '0 2px 8px rgba(0,0,0,0.15)' }}>\r\n                                                Dragging: {activeProduct.ProductName}\r\n                                            </div>\r\n                                        ) : null}\r\n                                    </DragOverlay>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DndContext>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default MenuTreeBuilder;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}